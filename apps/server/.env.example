# FHIR Server Local Development Configuration
# For running server locally without Docker (e.g., cargo run --bin fhir-server)
# Copy to server/.env and customize as needed
#
# NOTE: Variables use `FHIR__` prefix + double underscores (`__`) to map to the
# nested config structure.
# Example: FHIR__DATABASE__URL maps to config.database.url in config.rs
#
# For Docker deployment, use root-level .env files instead

# =============================================================================
# Database Configuration
# =============================================================================
# Standard DATABASE_URL format - compatible with most database tools
FHIR__DATABASE__URL=postgresql://fhir:fhir@localhost:5432/fhir

# Connection pool settings
FHIR__DATABASE__POOL_MIN_SIZE=4
FHIR__DATABASE__POOL_MAX_SIZE=40
FHIR__DATABASE__POOL_TIMEOUT_SECONDS=30

# Indexing performance settings
FHIR__DATABASE__INDEXING_BATCH_SIZE=50
FHIR__DATABASE__INDEXING_BULK_THRESHOLD=200

# Query timeout settings (prevent runaway queries)
FHIR__DATABASE__STATEMENT_TIMEOUT_SECONDS=300
FHIR__DATABASE__LOCK_TIMEOUT_SECONDS=30

# =============================================================================
# Server Configuration
# =============================================================================
FHIR__SERVER__HOST=0.0.0.0
FHIR__SERVER__PORT=8080

# CORS origins (optional, comma-separated)
# FHIR__SERVER__CORS_ORIGINS=http://localhost:3001,http://localhost:3000

# =============================================================================
# FHIR Configuration
# =============================================================================
FHIR__FHIR__VERSION=R4

# Search configuration
# `_text` searches narrative (resource.text.div) and `_content` searches all textual content.
# These can add indexing/query overhead; disable if you don't need full-text search.
FHIR__FHIR__SEARCH__ENABLE_TEXT=true
FHIR__FHIR__SEARCH__ENABLE_CONTENT=true

# =============================================================================
# Internal Packages (from fhir_packages/ directory)
# =============================================================================
# Install packages from the fhir_packages/ directory (default: true)
# These are custom packages stored locally in the project
FHIR__FHIR__INSTALL_INTERNAL_PACKAGES=true

# =============================================================================
# Default Package Configuration
# =============================================================================
# Control which default packages to install (core, extensions, terminology)
# All default to true if not specified

# Example: Disable terminology package
# FHIR__FHIR__DEFAULT_PACKAGES__TERMINOLOGY__INSTALL=false

# Example: Include examples for core package
# FHIR__FHIR__DEFAULT_PACKAGES__CORE__INSTALL_EXAMPLES=true

# Example: Filter core package to only specific resource types (JSON array)
# FHIR__FHIR__DEFAULT_PACKAGES__CORE__INCLUDE_RESOURCE_TYPES='["StructureDefinition","ValueSet","CodeSystem"]'

# Example: Exclude specific resource types from extensions package
# FHIR__FHIR__DEFAULT_PACKAGES__EXTENSIONS__EXCLUDE_RESOURCE_TYPES='["Patient","Observation"]'

# =============================================================================
# Custom Packages
# =============================================================================
# Add custom FHIR packages (requires config file for array syntax)
# See config.example.yaml for custom package configuration with filters

# Default response format
FHIR__FHIR__DEFAULT_FORMAT=json
FHIR__FHIR__DEFAULT_PREFER_RETURN=representation

# Resource operations
FHIR__FHIR__ALLOW_UPDATE_CREATE=true
FHIR__FHIR__HARD_DELETE=false

# Optional: Custom registry URL (defaults to packages.fhir.org)
# FHIR__FHIR__REGISTRY_URL=http://localhost:3000

# Optional: Packages to install on startup (JSON array format)
# FHIR__FHIR__PACKAGES='[{"name": "hl7.fhir.r4.core", "version": "4.0.1"}]'

# =============================================================================
# Worker Configuration (for fhir-worker binary)
# =============================================================================
FHIR__WORKERS__ENABLED=true
FHIR__WORKERS__MAX_CONCURRENT_JOBS=1
FHIR__WORKERS__POLL_INTERVAL_SECONDS=5

# =============================================================================
# Logging Configuration
# =============================================================================
# Log level: trace, debug, info, warn, error
FHIR__LOGGING__LEVEL=info

# Use JSON format for logs (recommended for production/log aggregation)
# false = human-readable format (development)
# true  = JSON format (production/ELK/Datadog/etc.)
FHIR__LOGGING__JSON=false

# File logging (optional, in addition to console)
# Useful for bare-metal deployments. Not needed for Docker (use container logs).
FHIR__LOGGING__FILE_ENABLED=false
FHIR__LOGGING__FILE_DIRECTORY=./logs
FHIR__LOGGING__FILE_PREFIX=fhir-server
# Rotation: daily, hourly, minutely, never
FHIR__LOGGING__FILE_ROTATION=daily

# Audit logging for FHIR operations (HIPAA/GDPR compliance)
# Logs all create/update/delete operations to separate audit trail
LOGGING__AUDIT_ENABLED=true
LOGGING__AUDIT_DIRECTORY=./logs/audit

# Alternative: Use RUST_LOG for more fine-grained control
# Overrides LOGGING__LEVEL if set
# RUST_LOG=debug
RUST_BACKTRACE=1

# Examples of selective logging:
# RUST_LOG=fhir_server=debug,tower_http=debug,sqlx=info
# RUST_LOG=info,fhir_server::services=debug
# RUST_LOG=fhir_server::db=trace  # Trace all database queries

# =============================================================================
# Admin UI Configuration
# =============================================================================
UI_PORT=3000
FHIR_SERVER_URL=http://localhost:8080

# Optional: protect `/admin/*` endpoints (and the Admin UI) with a single password.
# When set, login creates an HttpOnly session cookie (no external IdP needed).
FHIR__UI__PASSWORD=

# Recommended in production when FHIR__UI__PASSWORD is set:
# long random secret used to sign session cookies (stable across restarts).
FHIR__UI__SESSION_SECRET=

# Optional: admin session lifetime (seconds). Default: 43200 (12h)
FHIR__UI__SESSION_TTL_SECONDS=43200
