{"version":3,"sources":["../src/errors/fhir-error.ts","../src/search/builder.ts","../src/batch/builder.ts","../src/client.ts","../src/auth/client-credentials.ts","../src/auth/smart.ts"],"names":["data","response"],"mappings":"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","file":"index.cjs","sourcesContent":["import type { OperationOutcome } from \"fhir/r4\";\n\nexport class FhirError extends Error {\n  readonly status: number;\n  readonly operationOutcome?: OperationOutcome;\n  readonly response?: Response;\n\n  constructor(\n    message: string,\n    status: number,\n    operationOutcome?: OperationOutcome,\n    response?: Response\n  ) {\n    super(message);\n    this.name = \"FhirError\";\n    this.status = status;\n    this.operationOutcome = operationOutcome;\n    this.response = response;\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  get issues() {\n    return this.operationOutcome?.issue ?? [];\n  }\n\n  static fromResponse(\n    status: number,\n    operationOutcome?: OperationOutcome,\n    response?: Response\n  ): FhirError {\n    const message = operationOutcome?.issue?.[0]?.diagnostics\n      ?? operationOutcome?.issue?.[0]?.details?.text\n      ?? `FHIR request failed with status ${status}`;\n\n    switch (status) {\n      case 400:\n        return new ValidationError(message, operationOutcome, response);\n      case 401:\n        return new AuthenticationError(message, operationOutcome, response);\n      case 403:\n        return new ForbiddenError(message, operationOutcome, response);\n      case 404:\n        return new NotFoundError(message, operationOutcome, response);\n      case 409:\n        return new ConflictError(message, operationOutcome, response);\n      case 410:\n        return new GoneError(message, operationOutcome, response);\n      case 412:\n        return new PreconditionFailedError(message, operationOutcome, response);\n      case 422:\n        return new UnprocessableEntityError(message, operationOutcome, response);\n      default:\n        return new FhirError(message, status, operationOutcome, response);\n    }\n  }\n}\n\nexport class NotFoundError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 404, operationOutcome, response);\n    this.name = \"NotFoundError\";\n  }\n}\n\nexport class GoneError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 410, operationOutcome, response);\n    this.name = \"GoneError\";\n  }\n}\n\nexport class ConflictError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 409, operationOutcome, response);\n    this.name = \"ConflictError\";\n  }\n}\n\nexport class PreconditionFailedError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 412, operationOutcome, response);\n    this.name = \"PreconditionFailedError\";\n  }\n}\n\nexport class ValidationError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 400, operationOutcome, response);\n    this.name = \"ValidationError\";\n  }\n}\n\nexport class UnprocessableEntityError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 422, operationOutcome, response);\n    this.name = \"UnprocessableEntityError\";\n  }\n}\n\nexport class AuthenticationError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 401, operationOutcome, response);\n    this.name = \"AuthenticationError\";\n  }\n}\n\nexport class ForbiddenError extends FhirError {\n  constructor(message: string, operationOutcome?: OperationOutcome, response?: Response) {\n    super(message, 403, operationOutcome, response);\n    this.name = \"ForbiddenError\";\n  }\n}\n\nexport class NetworkError extends Error {\n  readonly cause?: Error;\n\n  constructor(message: string, cause?: Error) {\n    super(message);\n    this.name = \"NetworkError\";\n    this.cause = cause;\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n}\n\nexport class TimeoutError extends Error {\n  constructor(message: string = \"Request timed out\") {\n    super(message);\n    this.name = \"TimeoutError\";\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n}\n","import type { Bundle, Resource, BundleEntry } from \"fhir/r4\";\nimport type {\n  SearchResult,\n  SearchResultMeta,\n  SearchModifier,\n  SearchOptions,\n} from \"../types/search.js\";\nimport type { ResponseMeta } from \"../types/response.js\";\n\ntype ExecuteFn = (\n  resourceType: string,\n  params: URLSearchParams,\n  options?: SearchOptions\n) => Promise<{ bundle: Bundle; meta: ResponseMeta }>;\n\ntype ExecuteUrlFn = (\n  url: string,\n  options?: SearchOptions\n) => Promise<{ bundle: Bundle; meta: ResponseMeta }>;\n\nexport class SearchBuilder<T extends Resource = Resource> {\n  private readonly resourceType: string;\n  private readonly params: URLSearchParams;\n  private readonly executeFn: ExecuteFn;\n  private readonly executeUrlFn: ExecuteUrlFn;\n  private searchOptions?: SearchOptions;\n\n  constructor(\n    resourceType: string,\n    executeFn: ExecuteFn,\n    executeUrlFn: ExecuteUrlFn\n  ) {\n    this.resourceType = resourceType;\n    this.params = new URLSearchParams();\n    this.executeFn = executeFn;\n    this.executeUrlFn = executeUrlFn;\n  }\n\n  where(name: string, value: string | string[]): this {\n    if (Array.isArray(value)) {\n      // Multiple values for same parameter = OR\n      this.params.append(name, value.join(\",\"));\n    } else {\n      this.params.append(name, value);\n    }\n    return this;\n  }\n\n  whereExact(name: string, value: string): this {\n    this.params.append(`${name}:exact`, value);\n    return this;\n  }\n\n  whereContains(name: string, value: string): this {\n    this.params.append(`${name}:contains`, value);\n    return this;\n  }\n\n  whereText(name: string, value: string): this {\n    this.params.append(`${name}:text`, value);\n    return this;\n  }\n\n  whereMissing(name: string, isMissing: boolean = true): this {\n    this.params.append(`${name}:missing`, String(isMissing));\n    return this;\n  }\n\n  whereNot(name: string, value: string): this {\n    this.params.append(`${name}:not`, value);\n    return this;\n  }\n\n  whereBelow(name: string, value: string): this {\n    this.params.append(`${name}:below`, value);\n    return this;\n  }\n\n  whereAbove(name: string, value: string): this {\n    this.params.append(`${name}:above`, value);\n    return this;\n  }\n\n  whereIn(name: string, valueSetUrl: string): this {\n    this.params.append(`${name}:in`, valueSetUrl);\n    return this;\n  }\n\n  whereNotIn(name: string, valueSetUrl: string): this {\n    this.params.append(`${name}:not-in`, valueSetUrl);\n    return this;\n  }\n\n  whereOfType(name: string, system: string, code: string): this {\n    this.params.append(`${name}:of-type`, `${system}|${code}`);\n    return this;\n  }\n\n  whereIdentifier(name: string, system: string, value: string): this {\n    this.params.append(`${name}:identifier`, `${system}|${value}`);\n    return this;\n  }\n\n  withModifier(name: string, modifier: SearchModifier, value: string): this {\n    this.params.append(`${name}:${modifier}`, value);\n    return this;\n  }\n\n  include(value: string): this {\n    this.params.append(\"_include\", value);\n    return this;\n  }\n\n  includeIterate(value: string): this {\n    this.params.append(\"_include:iterate\", value);\n    return this;\n  }\n\n  revinclude(value: string): this {\n    this.params.append(\"_revinclude\", value);\n    return this;\n  }\n\n  revincludeIterate(value: string): this {\n    this.params.append(\"_revinclude:iterate\", value);\n    return this;\n  }\n\n  sort(field: string): this {\n    const existing = this.params.get(\"_sort\");\n    if (existing) {\n      this.params.set(\"_sort\", `${existing},${field}`);\n    } else {\n      this.params.set(\"_sort\", field);\n    }\n    return this;\n  }\n\n  count(n: number): this {\n    this.params.set(\"_count\", String(n));\n    return this;\n  }\n\n  offset(n: number): this {\n    this.params.set(\"_offset\", String(n));\n    return this;\n  }\n\n  summary(mode: \"true\" | \"text\" | \"data\" | \"count\" | \"false\"): this {\n    this.params.set(\"_summary\", mode);\n    return this;\n  }\n\n  elements(...elements: string[]): this {\n    this.params.set(\"_elements\", elements.join(\",\"));\n    return this;\n  }\n\n  contained(mode: \"true\" | \"false\" | \"both\"): this {\n    this.params.set(\"_contained\", mode);\n    return this;\n  }\n\n  containedType(mode: \"container\" | \"contained\"): this {\n    this.params.set(\"_containedType\", mode);\n    return this;\n  }\n\n  total(mode: \"none\" | \"estimate\" | \"accurate\"): this {\n    this.params.set(\"_total\", mode);\n    return this;\n  }\n\n  withOptions(options: SearchOptions): this {\n    this.searchOptions = options;\n    return this;\n  }\n\n  getParams(): URLSearchParams {\n    return new URLSearchParams(this.params);\n  }\n\n  async execute(): Promise<SearchResult<T>> {\n    const { bundle, meta } = await this.executeFn(\n      this.resourceType,\n      this.params,\n      this.searchOptions\n    );\n\n    return this.createSearchResult(bundle, meta);\n  }\n\n  private createSearchResult(bundle: Bundle, meta: ResponseMeta): SearchResult<T> {\n    const resources = this.extractResources(bundle);\n    const searchMeta: SearchResultMeta = {\n      ...meta,\n      total: bundle.total,\n      link: bundle.link,\n    };\n\n    const getLink = (rel: string): string | undefined => {\n      return bundle.link?.find((l) => l.relation === rel)?.url;\n    };\n\n    const result: SearchResult<T> = {\n      bundle,\n      resources,\n      total: bundle.total,\n      meta: searchMeta,\n\n      hasNextPage: () => !!getLink(\"next\"),\n      hasPrevPage: () => !!getLink(\"previous\") || !!getLink(\"prev\"),\n\n      nextPage: async () => {\n        const nextUrl = getLink(\"next\");\n        if (!nextUrl) {\n          throw new Error(\"No next page available\");\n        }\n        const { bundle: nextBundle, meta: nextMeta } = await this.executeUrlFn(\n          nextUrl,\n          this.searchOptions\n        );\n        return this.createSearchResult(nextBundle, nextMeta);\n      },\n\n      prevPage: async () => {\n        const prevUrl = getLink(\"previous\") ?? getLink(\"prev\");\n        if (!prevUrl) {\n          throw new Error(\"No previous page available\");\n        }\n        const { bundle: prevBundle, meta: prevMeta } = await this.executeUrlFn(\n          prevUrl,\n          this.searchOptions\n        );\n        return this.createSearchResult(prevBundle, prevMeta);\n      },\n    };\n\n    return result;\n  }\n\n  private extractResources(bundle: Bundle): T[] {\n    if (!bundle.entry) {\n      return [];\n    }\n\n    return bundle.entry\n      .filter((entry: BundleEntry): entry is BundleEntry & { resource: T } => {\n        if (!entry.resource) return false;\n        // Only include resources matching the search type (exclude _include results)\n        const searchMode = entry.search?.mode;\n        return searchMode === undefined || searchMode === \"match\";\n      })\n      .map((entry) => entry.resource);\n  }\n}\n","import type { Bundle, BundleEntry, Resource, FhirResource } from \"fhir/r4\";\nimport type { ResponseMeta } from \"../types/response.js\";\nimport type { JsonPatchOperation } from \"../types/patch.js\";\n\ntype BundleType = \"batch\" | \"transaction\";\n\nexport interface BundleEntryOptions {\n  fullUrl?: string;\n  ifMatch?: string;\n  ifNoneMatch?: string;\n  ifNoneExist?: string;\n  ifModifiedSince?: string;\n}\n\nexport interface BundleResult {\n  bundle: Bundle;\n  meta: ResponseMeta;\n  getResource<T extends Resource>(index: number): T | undefined;\n  getResourceByFullUrl<T extends Resource>(fullUrl: string): T | undefined;\n  isSuccess(index: number): boolean;\n  getStatus(index: number): number | undefined;\n  getLocation(index: number): string | undefined;\n}\n\ntype ExecuteFn = (\n  bundle: Bundle\n) => Promise<{ bundle: Bundle; meta: ResponseMeta }>;\n\nexport class BundleBuilder {\n  private readonly type: BundleType;\n  private readonly entries: BundleEntry[] = [];\n  private readonly executeFn: ExecuteFn;\n\n  constructor(type: BundleType, executeFn: ExecuteFn) {\n    this.type = type;\n    this.executeFn = executeFn;\n  }\n\n  create<T extends Resource>(resource: T, options?: BundleEntryOptions): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl,\n      resource: resource as FhirResource,\n      request: {\n        method: \"POST\",\n        url: resource.resourceType,\n        ifNoneExist: options?.ifNoneExist,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  update<T extends Resource>(resource: T, options?: BundleEntryOptions): this {\n    if (!resource.id) {\n      throw new Error(\"Resource must have an id for update\");\n    }\n\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl ?? `${resource.resourceType}/${resource.id}`,\n      resource: resource as FhirResource,\n      request: {\n        method: \"PUT\",\n        url: `${resource.resourceType}/${resource.id}`,\n        ifMatch: options?.ifMatch,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  conditionalUpdate<T extends Resource>(\n    resource: T,\n    searchParams: string,\n    options?: BundleEntryOptions\n  ): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl,\n      resource: resource as FhirResource,\n      request: {\n        method: \"PUT\",\n        url: `${resource.resourceType}?${searchParams}`,\n        ifMatch: options?.ifMatch,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  patch(\n    resourceType: string,\n    id: string,\n    operations: JsonPatchOperation[],\n    options?: BundleEntryOptions\n  ): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl ?? `${resourceType}/${id}`,\n      resource: {\n        resourceType: \"Binary\",\n        contentType: \"application/json-patch+json\",\n        data: btoa(JSON.stringify(operations)),\n      },\n      request: {\n        method: \"PATCH\",\n        url: `${resourceType}/${id}`,\n        ifMatch: options?.ifMatch,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  delete(\n    resourceType: string,\n    id: string,\n    options?: BundleEntryOptions\n  ): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl ?? `${resourceType}/${id}`,\n      request: {\n        method: \"DELETE\",\n        url: `${resourceType}/${id}`,\n        ifMatch: options?.ifMatch,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  conditionalDelete(\n    resourceType: string,\n    searchParams: string,\n    options?: BundleEntryOptions\n  ): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl,\n      request: {\n        method: \"DELETE\",\n        url: `${resourceType}?${searchParams}`,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  read(resourceType: string, id: string, options?: BundleEntryOptions): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl ?? `${resourceType}/${id}`,\n      request: {\n        method: \"GET\",\n        url: `${resourceType}/${id}`,\n        ifNoneMatch: options?.ifNoneMatch,\n        ifModifiedSince: options?.ifModifiedSince,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  search(resourceType: string, params: string, options?: BundleEntryOptions): this {\n    const entry: BundleEntry = {\n      fullUrl: options?.fullUrl,\n      request: {\n        method: \"GET\",\n        url: `${resourceType}?${params}`,\n      },\n    };\n    this.entries.push(entry);\n    return this;\n  }\n\n  addEntry(entry: BundleEntry): this {\n    this.entries.push(entry);\n    return this;\n  }\n\n  getBundle(): Bundle {\n    return {\n      resourceType: \"Bundle\",\n      type: this.type,\n      entry: this.entries,\n    };\n  }\n\n  async execute(): Promise<BundleResult> {\n    const bundle = this.getBundle();\n    const { bundle: responseBundle, meta } = await this.executeFn(bundle);\n\n    return this.createBundleResult(responseBundle, meta);\n  }\n\n  private createBundleResult(bundle: Bundle, meta: ResponseMeta): BundleResult {\n    const fullUrlToIndex = new Map<string, number>();\n    this.entries.forEach((entry, index) => {\n      if (entry.fullUrl) {\n        fullUrlToIndex.set(entry.fullUrl, index);\n      }\n    });\n\n    return {\n      bundle,\n      meta,\n\n      getResource<T extends Resource>(index: number): T | undefined {\n        return bundle.entry?.[index]?.resource as T | undefined;\n      },\n\n      getResourceByFullUrl<T extends Resource>(fullUrl: string): T | undefined {\n        const index = fullUrlToIndex.get(fullUrl);\n        if (index === undefined) return undefined;\n        return bundle.entry?.[index]?.resource as T | undefined;\n      },\n\n      isSuccess(index: number): boolean {\n        const status = this.getStatus(index);\n        return status !== undefined && status >= 200 && status < 300;\n      },\n\n      getStatus(index: number): number | undefined {\n        const statusStr = bundle.entry?.[index]?.response?.status;\n        if (!statusStr) return undefined;\n        const match = statusStr.match(/^(\\d+)/);\n        return match?.[1] ? parseInt(match[1], 10) : undefined;\n      },\n\n      getLocation(index: number): string | undefined {\n        return bundle.entry?.[index]?.response?.location;\n      },\n    };\n  }\n}\n","import type {\n  Resource,\n  Bundle,\n  OperationOutcome,\n  Parameters,\n  CapabilityStatement,\n} from \"fhir/r4\";\n\nimport type {\n  FhirClientConfig,\n  AuthConfig,\n  RequestOptions,\n  CreateOptions,\n  UpdateOptions,\n  DeleteOptions,\n  ReadOptions,\n  HistoryOptions,\n  OperationOptions,\n} from \"./types/client.js\";\n\nimport type {\n  FhirResponse,\n  ResponseMeta,\n  BundleResponse,\n  DeleteResponse,\n  CapabilitiesResponse,\n} from \"./types/response.js\";\n\nimport type { SearchOptions } from \"./types/search.js\";\nimport type { JsonPatchOperation } from \"./types/patch.js\";\n\nimport { FhirError, NetworkError, TimeoutError } from \"./errors/fhir-error.js\";\nimport { SearchBuilder } from \"./search/builder.js\";\nimport { BundleBuilder } from \"./batch/builder.js\";\n\nexport class FhirClient {\n  private readonly baseUrl: string;\n  private readonly auth?: AuthConfig;\n  private readonly timeout: number;\n  private readonly defaultHeaders: Record<string, string>;\n\n  constructor(config: FhirClientConfig) {\n    this.baseUrl = config.baseUrl.replace(/\\/$/, \"\");\n    this.auth = config.auth;\n    this.timeout = config.timeout ?? 30000;\n    this.defaultHeaders = {\n      Accept: \"application/fhir+json\",\n      ...config.headers,\n    };\n  }\n\n  private async getAuthHeader(): Promise<string | undefined> {\n    if (!this.auth) return undefined;\n\n    if (\"token\" in this.auth) {\n      return `Bearer ${this.auth.token}`;\n    }\n\n    if (\"tokenProvider\" in this.auth) {\n      const token = await this.auth.tokenProvider();\n      return `Bearer ${token}`;\n    }\n\n    return undefined;\n  }\n\n  private async request<T>(\n    method: string,\n    path: string,\n    options?: RequestOptions & { body?: unknown; contentType?: string }\n  ): Promise<{ data: T; response: Response }> {\n    const url = path.startsWith(\"http\") ? path : `${this.baseUrl}/${path}`;\n\n    const headers: Record<string, string> = { ...this.defaultHeaders };\n\n    const authHeader = await this.getAuthHeader();\n    if (authHeader) {\n      headers[\"Authorization\"] = authHeader;\n    }\n\n    if (options?.headers) {\n      Object.assign(headers, options.headers);\n    }\n\n    if (options?.ifMatch) {\n      headers[\"If-Match\"] = options.ifMatch;\n    }\n    if (options?.ifNoneMatch) {\n      headers[\"If-None-Match\"] = options.ifNoneMatch;\n    }\n    if (options?.ifNoneExist) {\n      headers[\"If-None-Exist\"] = options.ifNoneExist;\n    }\n    if (options?.ifModifiedSince) {\n      headers[\"If-Modified-Since\"] = options.ifModifiedSince.toUTCString();\n    }\n    if (options?.prefer) {\n      headers[\"Prefer\"] = options.prefer;\n    }\n\n    let body: string | undefined;\n    if (options?.body !== undefined) {\n      if (options.contentType) {\n        headers[\"Content-Type\"] = options.contentType;\n      } else {\n        headers[\"Content-Type\"] = \"application/fhir+json\";\n      }\n      body = JSON.stringify(options.body);\n    }\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.timeout);\n\n    const signal = options?.signal\n      ? this.mergeSignals(options.signal, controller.signal)\n      : controller.signal;\n\n    try {\n      const response = await fetch(url, {\n        method,\n        headers,\n        body,\n        signal,\n      });\n\n      clearTimeout(timeoutId);\n\n      if (!response.ok) {\n        let operationOutcome: OperationOutcome | undefined;\n        try {\n          const errorBody = await response.json();\n          if (errorBody?.resourceType === \"OperationOutcome\") {\n            operationOutcome = errorBody as OperationOutcome;\n          }\n        } catch {\n          // Ignore JSON parse errors for error responses\n        }\n        throw FhirError.fromResponse(response.status, operationOutcome, response);\n      }\n\n      // Handle 204 No Content\n      if (response.status === 204) {\n        return { data: undefined as T, response };\n      }\n\n      const data = (await response.json()) as T;\n      return { data, response };\n    } catch (error) {\n      clearTimeout(timeoutId);\n\n      if (error instanceof FhirError) {\n        throw error;\n      }\n\n      if (error instanceof DOMException && error.name === \"AbortError\") {\n        throw new TimeoutError();\n      }\n\n      if (error instanceof TypeError) {\n        throw new NetworkError(`Network request failed: ${error.message}`, error);\n      }\n\n      throw error;\n    }\n  }\n\n  private mergeSignals(signal1: AbortSignal, signal2: AbortSignal): AbortSignal {\n    const controller = new AbortController();\n\n    const abort = () => controller.abort();\n\n    signal1.addEventListener(\"abort\", abort);\n    signal2.addEventListener(\"abort\", abort);\n\n    if (signal1.aborted || signal2.aborted) {\n      controller.abort();\n    }\n\n    return controller.signal;\n  }\n\n  private parseResponseMeta(response: Response): ResponseMeta {\n    const meta: ResponseMeta = {\n      status: response.status,\n    };\n\n    const etag = response.headers.get(\"ETag\");\n    if (etag) {\n      meta.etag = etag;\n    }\n\n    const lastModified = response.headers.get(\"Last-Modified\");\n    if (lastModified) {\n      meta.lastModified = new Date(lastModified);\n    }\n\n    const location = response.headers.get(\"Location\");\n    if (location) {\n      meta.location = location;\n    }\n\n    const contentLocation = response.headers.get(\"Content-Location\");\n    if (contentLocation) {\n      meta.contentLocation = contentLocation;\n    }\n\n    return meta;\n  }\n\n  // CRUD Operations\n\n  async createResource<T extends Resource>(\n    resource: T,\n    options?: CreateOptions\n  ): Promise<FhirResponse<T>> {\n    const { data, response } = await this.request<T>(\n      \"POST\",\n      resource.resourceType,\n      { ...options, body: resource }\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async readResource<T extends Resource>(\n    resourceType: string,\n    id: string,\n    options?: ReadOptions\n  ): Promise<FhirResponse<T>> {\n    let path = `${resourceType}/${id}`;\n\n    const params = new URLSearchParams();\n    if (options?.summary) {\n      params.set(\"_summary\", options.summary);\n    }\n    if (options?.elements?.length) {\n      params.set(\"_elements\", options.elements.join(\",\"));\n    }\n\n    if (params.toString()) {\n      path += `?${params.toString()}`;\n    }\n\n    const { data, response } = await this.request<T>(\"GET\", path, options);\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async vreadResource<T extends Resource>(\n    resourceType: string,\n    id: string,\n    versionId: string,\n    options?: RequestOptions\n  ): Promise<FhirResponse<T>> {\n    const { data, response } = await this.request<T>(\n      \"GET\",\n      `${resourceType}/${id}/_history/${versionId}`,\n      options\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async updateResource<T extends Resource>(\n    resource: T,\n    options?: UpdateOptions\n  ): Promise<FhirResponse<T>> {\n    if (!resource.id) {\n      throw new Error(\"Resource must have an id for update\");\n    }\n\n    const { data, response } = await this.request<T>(\n      \"PUT\",\n      `${resource.resourceType}/${resource.id}`,\n      { ...options, body: resource }\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async patchResource<T extends Resource>(\n    resourceType: string,\n    id: string,\n    operations: JsonPatchOperation[],\n    options?: UpdateOptions\n  ): Promise<FhirResponse<T>> {\n    const { data, response } = await this.request<T>(\n      \"PATCH\",\n      `${resourceType}/${id}`,\n      {\n        ...options,\n        body: operations,\n        contentType: \"application/json-patch+json\",\n      }\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async deleteResource(\n    resourceType: string,\n    id: string,\n    options?: DeleteOptions\n  ): Promise<DeleteResponse> {\n    const { data, response } = await this.request<OperationOutcome | undefined>(\n      \"DELETE\",\n      `${resourceType}/${id}`,\n      options\n    );\n\n    return {\n      operationOutcome: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  // Conditional Operations\n\n  async conditionalCreate<T extends Resource>(\n    resource: T,\n    searchParams: string,\n    options?: CreateOptions\n  ): Promise<FhirResponse<T>> {\n    const { data, response } = await this.request<T>(\n      \"POST\",\n      resource.resourceType,\n      {\n        ...options,\n        body: resource,\n        ifNoneExist: searchParams,\n      }\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async conditionalUpdate<T extends Resource>(\n    resource: T,\n    searchParams: string,\n    options?: UpdateOptions\n  ): Promise<FhirResponse<T>> {\n    const { data, response } = await this.request<T>(\n      \"PUT\",\n      `${resource.resourceType}?${searchParams}`,\n      { ...options, body: resource }\n    );\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async conditionalDelete(\n    resourceType: string,\n    searchParams: string,\n    options?: DeleteOptions\n  ): Promise<DeleteResponse> {\n    const { data, response } = await this.request<OperationOutcome | undefined>(\n      \"DELETE\",\n      `${resourceType}?${searchParams}`,\n      options\n    );\n\n    return {\n      operationOutcome: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  // Search\n\n  search<T extends Resource>(resourceType: string): SearchBuilder<T> {\n    return new SearchBuilder<T>(\n      resourceType,\n      (type, params, options) => this.executeSearch(type, params, options),\n      (url, options) => this.executeSearchUrl(url, options)\n    );\n  }\n\n  private async executeSearch(\n    resourceType: string,\n    params: URLSearchParams,\n    options?: SearchOptions\n  ): Promise<{ bundle: Bundle; meta: ResponseMeta }> {\n    const query = params.toString();\n    const path = query ? `${resourceType}?${query}` : resourceType;\n\n    const { data, response } = await this.request<Bundle>(\"GET\", path, options);\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  private async executeSearchUrl(\n    url: string,\n    options?: SearchOptions\n  ): Promise<{ bundle: Bundle; meta: ResponseMeta }> {\n    const { data, response } = await this.request<Bundle>(\"GET\", url, options);\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  // Batch / Transaction\n\n  batch(): BundleBuilder {\n    return new BundleBuilder(\"batch\", (bundle) => this.executeBundle(bundle));\n  }\n\n  transaction(): BundleBuilder {\n    return new BundleBuilder(\"transaction\", (bundle) => this.executeBundle(bundle));\n  }\n\n  private async executeBundle(\n    bundle: Bundle\n  ): Promise<{ bundle: Bundle; meta: ResponseMeta }> {\n    const { data, response } = await this.request<Bundle>(\"POST\", \"\", {\n      body: bundle,\n    });\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  // Operations\n\n  async operation<T extends Resource | Parameters = Parameters>(\n    name: string,\n    params?: Parameters,\n    options?: OperationOptions\n  ): Promise<FhirResponse<T>> {\n    const method = options?.method ?? \"POST\";\n    const path = `$${name}`;\n\n    if (method === \"GET\" && params) {\n      const searchParams = this.parametersToSearchParams(params);\n      const { data, response } = await this.request<T>(\n        \"GET\",\n        `${path}?${searchParams.toString()}`,\n        options\n      );\n      return { resource: data, meta: this.parseResponseMeta(response) };\n    }\n\n    const { data, response } = await this.request<T>(method, path, {\n      ...options,\n      body: params,\n    });\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async typeOperation<T extends Resource | Parameters = Parameters>(\n    resourceType: string,\n    name: string,\n    params?: Parameters,\n    options?: OperationOptions\n  ): Promise<FhirResponse<T>> {\n    const method = options?.method ?? \"POST\";\n    const path = `${resourceType}/$${name}`;\n\n    if (method === \"GET\" && params) {\n      const searchParams = this.parametersToSearchParams(params);\n      const { data, response } = await this.request<T>(\n        \"GET\",\n        `${path}?${searchParams.toString()}`,\n        options\n      );\n      return { resource: data, meta: this.parseResponseMeta(response) };\n    }\n\n    const { data, response } = await this.request<T>(method, path, {\n      ...options,\n      body: params,\n    });\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async instanceOperation<T extends Resource | Parameters = Parameters>(\n    resourceType: string,\n    id: string,\n    name: string,\n    params?: Parameters,\n    options?: OperationOptions\n  ): Promise<FhirResponse<T>> {\n    const method = options?.method ?? \"POST\";\n    const path = `${resourceType}/${id}/$${name}`;\n\n    if (method === \"GET\" && params) {\n      const searchParams = this.parametersToSearchParams(params);\n      const { data, response } = await this.request<T>(\n        \"GET\",\n        `${path}?${searchParams.toString()}`,\n        options\n      );\n      return { resource: data, meta: this.parseResponseMeta(response) };\n    }\n\n    const { data, response } = await this.request<T>(method, path, {\n      ...options,\n      body: params,\n    });\n\n    return {\n      resource: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  private parametersToSearchParams(params: Parameters): URLSearchParams {\n    const searchParams = new URLSearchParams();\n\n    if (params.parameter) {\n      for (const param of params.parameter) {\n        if (!param.name) continue;\n\n        const value =\n          param.valueString ??\n          param.valueBoolean?.toString() ??\n          param.valueInteger?.toString() ??\n          param.valueDecimal?.toString() ??\n          param.valueUri ??\n          param.valueCode ??\n          param.valueDate ??\n          param.valueDateTime ??\n          param.valueTime ??\n          param.valueInstant;\n\n        if (value !== undefined) {\n          searchParams.append(param.name, value);\n        }\n      }\n    }\n\n    return searchParams;\n  }\n\n  // History\n\n  async history(\n    resourceType: string,\n    id: string,\n    options?: HistoryOptions\n  ): Promise<BundleResponse> {\n    let path = `${resourceType}/${id}/_history`;\n    path = this.appendHistoryParams(path, options);\n\n    const { data, response } = await this.request<Bundle>(\"GET\", path, options);\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async typeHistory(\n    resourceType: string,\n    options?: HistoryOptions\n  ): Promise<BundleResponse> {\n    let path = `${resourceType}/_history`;\n    path = this.appendHistoryParams(path, options);\n\n    const { data, response } = await this.request<Bundle>(\"GET\", path, options);\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  async systemHistory(options?: HistoryOptions): Promise<BundleResponse> {\n    let path = `_history`;\n    path = this.appendHistoryParams(path, options);\n\n    const { data, response } = await this.request<Bundle>(\"GET\", path, options);\n\n    return {\n      bundle: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n\n  private appendHistoryParams(path: string, options?: HistoryOptions): string {\n    if (!options) return path;\n\n    const params = new URLSearchParams();\n\n    if (options.count !== undefined) {\n      params.set(\"_count\", options.count.toString());\n    }\n\n    if (options.since) {\n      const sinceValue =\n        options.since instanceof Date\n          ? options.since.toISOString()\n          : options.since;\n      params.set(\"_since\", sinceValue);\n    }\n\n    if (options.at) {\n      const atValue =\n        options.at instanceof Date ? options.at.toISOString() : options.at;\n      params.set(\"_at\", atValue);\n    }\n\n    const queryString = params.toString();\n    return queryString ? `${path}?${queryString}` : path;\n  }\n\n  // Capabilities\n\n  async capabilities(options?: RequestOptions): Promise<CapabilitiesResponse> {\n    const { data, response } = await this.request<CapabilityStatement>(\n      \"GET\",\n      \"metadata\",\n      options\n    );\n\n    return {\n      capabilityStatement: data,\n      meta: this.parseResponseMeta(response),\n    };\n  }\n}\n","import type { TokenProvider } from \"../types/client.js\";\n\nexport interface ClientCredentialsConfig {\n  clientId: string;\n  clientSecret: string;\n  issuer?: string;\n  tokenEndpoint?: string;\n  scope?: string;\n}\n\ninterface TokenResponse {\n  access_token: string;\n  token_type: string;\n  expires_in?: number;\n  scope?: string;\n}\n\ninterface OidcConfig {\n  token_endpoint: string;\n}\n\nexport class ClientCredentialsAuth {\n  private readonly config: ClientCredentialsConfig;\n  private cachedToken?: string;\n  private tokenExpiresAt?: number;\n  private tokenEndpoint?: string;\n  private tokenPromise?: Promise<string>;\n\n  constructor(config: ClientCredentialsConfig) {\n    if (!config.issuer && !config.tokenEndpoint) {\n      throw new Error(\"Either 'issuer' or 'tokenEndpoint' must be provided\");\n    }\n    this.config = config;\n    this.tokenEndpoint = config.tokenEndpoint;\n  }\n\n  private async discoverTokenEndpoint(): Promise<string> {\n    if (this.tokenEndpoint) {\n      return this.tokenEndpoint;\n    }\n\n    const discoveryUrl = this.config.issuer!.replace(/\\/$/, \"\") + \"/.well-known/openid-configuration\";\n\n    const response = await fetch(discoveryUrl, {\n      headers: { Accept: \"application/json\" },\n    });\n\n    if (!response.ok) {\n      throw new Error(`OIDC discovery failed: ${response.status} ${response.statusText}`);\n    }\n\n    const config = (await response.json()) as OidcConfig;\n\n    if (!config.token_endpoint) {\n      throw new Error(\"Token endpoint not found in OIDC configuration\");\n    }\n\n    this.tokenEndpoint = config.token_endpoint;\n    return this.tokenEndpoint;\n  }\n\n  private async fetchToken(): Promise<string> {\n    const tokenEndpoint = await this.discoverTokenEndpoint();\n\n    const body = new URLSearchParams({\n      grant_type: \"client_credentials\",\n      client_id: this.config.clientId,\n      client_secret: this.config.clientSecret,\n    });\n\n    if (this.config.scope) {\n      body.set(\"scope\", this.config.scope);\n    }\n\n    const response = await fetch(tokenEndpoint, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        Accept: \"application/json\",\n      },\n      body: body.toString(),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Token request failed: ${response.status} ${errorText}`);\n    }\n\n    const tokenResponse = (await response.json()) as TokenResponse;\n\n    this.cachedToken = tokenResponse.access_token;\n\n    if (tokenResponse.expires_in) {\n      // Refresh 60 seconds before expiry to avoid edge cases\n      const bufferSeconds = 60;\n      this.tokenExpiresAt = Date.now() + (tokenResponse.expires_in - bufferSeconds) * 1000;\n    }\n\n    return this.cachedToken;\n  }\n\n  private isTokenValid(): boolean {\n    if (!this.cachedToken) {\n      return false;\n    }\n    if (this.tokenExpiresAt && Date.now() >= this.tokenExpiresAt) {\n      return false;\n    }\n    return true;\n  }\n\n  async getToken(): Promise<string> {\n    if (this.isTokenValid()) {\n      return this.cachedToken!;\n    }\n\n    // Prevent concurrent token requests\n    if (this.tokenPromise) {\n      return this.tokenPromise;\n    }\n\n    this.tokenPromise = this.fetchToken().finally(() => {\n      this.tokenPromise = undefined;\n    });\n\n    return this.tokenPromise;\n  }\n\n  tokenProvider(): TokenProvider {\n    return () => this.getToken();\n  }\n\n  clearCache(): void {\n    this.cachedToken = undefined;\n    this.tokenExpiresAt = undefined;\n  }\n}\n","import type { TokenProvider } from \"../types/client.js\";\n\nexport interface SmartConfiguration {\n  issuer: string;\n  authorization_endpoint: string;\n  token_endpoint: string;\n  jwks_uri: string;\n  capabilities?: string[];\n  registration_endpoint?: string;\n  introspection_endpoint?: string;\n  revocation_endpoint?: string;\n  userinfo_endpoint?: string;\n}\n\nexport interface SmartAuthConfig {\n  fhirBaseUrl: string;\n  clientId: string;\n  redirectUri: string;\n  scope?: string;\n  launch?: string;\n  state?: string;\n  storage?: SmartAuthStorage;\n}\n\nexport interface SmartAuthStorage {\n  get(key: string): string | null;\n  set(key: string, value: string): void;\n  remove(key: string): void;\n}\n\ninterface TokenResponse {\n  access_token: string;\n  token_type: string;\n  expires_in?: number;\n  refresh_token?: string;\n  scope?: string;\n  patient?: string;\n  encounter?: string;\n  need_patient_banner?: boolean;\n  smart_style_url?: string;\n}\n\ninterface TokenData {\n  accessToken: string;\n  refreshToken?: string;\n  expiresAt: number;\n  patient?: string;\n  scope?: string;\n}\n\nconst DEFAULT_SCOPE = \"openid profile fhirUser user/*.*\";\n\n/**\n * SMART on FHIR Authorization Code Flow with PKCE\n *\n * Handles OAuth2 authorization code flow with PKCE for secure authentication.\n * Supports automatic token refresh and seamless integration with FhirClient.\n */\nexport class SmartAuth {\n  private readonly config: SmartAuthConfig;\n  private readonly storage: SmartAuthStorage;\n  private smartConfig: SmartConfiguration | null = null;\n  private tokenData: TokenData | null = null;\n  private tokenPromise: Promise<string> | null = null;\n\n  constructor(config: SmartAuthConfig) {\n    this.config = {\n      scope: DEFAULT_SCOPE,\n      ...config,\n    };\n    this.storage = config.storage ?? this.createDefaultStorage();\n    this.restoreToken();\n  }\n\n  /**\n   * Discover SMART configuration from the FHIR server\n   */\n  async discover(): Promise<SmartConfiguration> {\n    if (this.smartConfig) {\n      return this.smartConfig;\n    }\n\n    const url = `${this.config.fhirBaseUrl}/.well-known/smart-configuration`;\n    const response = await fetch(url, {\n      headers: { Accept: \"application/json\" },\n    });\n\n    if (!response.ok) {\n      throw new Error(\n        `SMART discovery failed: ${response.status} ${response.statusText}`\n      );\n    }\n\n    this.smartConfig = (await response.json()) as SmartConfiguration;\n    return this.smartConfig;\n  }\n\n  /**\n   * Generate PKCE code verifier and challenge\n   */\n  private async generatePKCE(): Promise<{ verifier: string; challenge: string }> {\n    if (typeof crypto === \"undefined\" || !crypto.getRandomValues) {\n      throw new Error(\n        \"Web Crypto API not available. This requires a modern browser or Node.js 15+.\"\n      );\n    }\n\n    // Generate random code verifier (43-128 characters)\n    const array = new Uint8Array(32);\n    crypto.getRandomValues(array);\n    const verifier = btoa(String.fromCharCode(...array))\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=/g, \"\");\n\n    // Generate code challenge (SHA256 hash, base64url encoded)\n    if (!crypto.subtle) {\n      throw new Error(\n        \"crypto.subtle not available. This requires HTTPS in browsers or Node.js 15+.\"\n      );\n    }\n\n    const encoder = new TextEncoder();\n    const data = encoder.encode(verifier);\n    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", data);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    const challenge = btoa(String.fromCharCode(...hashArray))\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=/g, \"\");\n\n    return { verifier, challenge };\n  }\n\n  /**\n   * Generate random state for CSRF protection\n   */\n  private generateState(): string {\n    const array = new Uint8Array(16);\n    crypto.getRandomValues(array);\n    return btoa(String.fromCharCode(...array))\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=/g, \"\");\n  }\n\n  /**\n   * Initiate authorization flow\n   * In browser: redirects to authorization server\n   * In Node.js: returns authorization URL\n   */\n  async authorize(): Promise<string> {\n    const config = await this.discover();\n\n    const { verifier, challenge } = await this.generatePKCE();\n    const state = this.config.state ?? this.generateState();\n\n    // Store PKCE verifier and state for callback verification\n    this.storage.set(\"smart_pkce_verifier\", verifier);\n    this.storage.set(\"smart_oauth_state\", state);\n\n    const params = new URLSearchParams({\n      response_type: \"code\",\n      client_id: this.config.clientId,\n      redirect_uri: this.config.redirectUri,\n      scope: this.config.scope ?? DEFAULT_SCOPE,\n      code_challenge: challenge,\n      code_challenge_method: \"S256\",\n      state,\n      aud: this.config.fhirBaseUrl,\n    });\n\n    if (this.config.launch) {\n      params.set(\"launch\", this.config.launch);\n    }\n\n    const authUrl = `${config.authorization_endpoint}?${params.toString()}`;\n\n    // In browser environment, redirect automatically\n    if (typeof window !== \"undefined\" && window.location) {\n      window.location.href = authUrl;\n    }\n\n    return authUrl;\n  }\n\n  /**\n   * Handle authorization callback and exchange code for token\n   */\n  async handleCallback(\n    code: string,\n    state: string,\n    error?: string\n  ): Promise<TokenResponse> {\n    if (error) {\n      throw new Error(`Authorization error: ${error}`);\n    }\n\n    const storedState = this.storage.get(\"smart_oauth_state\");\n    if (!storedState || storedState !== state) {\n      throw new Error(\"Invalid state parameter - possible CSRF attack\");\n    }\n\n    const verifier = this.storage.get(\"smart_pkce_verifier\");\n    if (!verifier) {\n      throw new Error(\"PKCE verifier not found - authorization flow may have expired\");\n    }\n\n    const config = await this.discover();\n\n    const params = new URLSearchParams({\n      grant_type: \"authorization_code\",\n      code,\n      redirect_uri: this.config.redirectUri,\n      client_id: this.config.clientId,\n      code_verifier: verifier,\n    });\n\n    const response = await fetch(config.token_endpoint, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        Accept: \"application/json\",\n      },\n      body: params.toString(),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      throw new Error(`Token exchange failed: ${response.status} ${errorText}`);\n    }\n\n    const tokenResponse = (await response.json()) as TokenResponse;\n    this.setToken(tokenResponse);\n\n    // Clean up stored values\n    this.storage.remove(\"smart_oauth_state\");\n    this.storage.remove(\"smart_pkce_verifier\");\n\n    return tokenResponse;\n  }\n\n  /**\n   * Refresh access token using refresh token\n   */\n  private async refreshToken(): Promise<string> {\n    if (!this.tokenData?.refreshToken) {\n      throw new Error(\"No refresh token available\");\n    }\n\n    const config = await this.discover();\n\n    const params = new URLSearchParams({\n      grant_type: \"refresh_token\",\n      refresh_token: this.tokenData.refreshToken,\n      client_id: this.config.clientId,\n    });\n\n    const response = await fetch(config.token_endpoint, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\",\n        Accept: \"application/json\",\n      },\n      body: params.toString(),\n    });\n\n    if (!response.ok) {\n      const errorText = await response.text();\n      // If refresh fails, clear token data\n      this.clearToken();\n      throw new Error(`Token refresh failed: ${response.status} ${errorText}`);\n    }\n\n    const tokenResponse = (await response.json()) as TokenResponse;\n    this.setToken(tokenResponse);\n\n    return this.tokenData.accessToken;\n  }\n\n  /**\n   * Set token data and store in storage\n   */\n  private setToken(tokenResponse: TokenResponse): void {\n    const expiresIn = tokenResponse.expires_in ?? 3600;\n    const expiresAt = Date.now() + expiresIn * 1000 - 60000; // Refresh 1 minute early\n\n    this.tokenData = {\n      accessToken: tokenResponse.access_token,\n      refreshToken: tokenResponse.refresh_token,\n      expiresAt,\n      patient: tokenResponse.patient,\n      scope: tokenResponse.scope,\n    };\n\n    this.storage.set(\"smart_token_data\", JSON.stringify(this.tokenData));\n  }\n\n  /**\n   * Restore token from storage\n   */\n  private restoreToken(): void {\n    const stored = this.storage.get(\"smart_token_data\");\n    if (stored) {\n      try {\n        this.tokenData = JSON.parse(stored) as TokenData;\n        // Validate token hasn't expired\n        if (this.tokenData && Date.now() >= this.tokenData.expiresAt) {\n          this.clearToken();\n        }\n      } catch {\n        this.clearToken();\n      }\n    }\n  }\n\n  /**\n   * Check if user is authenticated\n   */\n  isAuthenticated(): boolean {\n    return this.tokenData !== null && Date.now() < this.tokenData.expiresAt;\n  }\n\n  /**\n   * Get current access token, refreshing if necessary\n   */\n  async getToken(): Promise<string> {\n    if (!this.tokenData) {\n      throw new Error(\"Not authenticated. Call authorize() first.\");\n    }\n\n    // Check if token needs refresh\n    if (Date.now() >= this.tokenData.expiresAt) {\n      // Prevent concurrent refresh requests\n      if (this.tokenPromise) {\n        return this.tokenPromise;\n      }\n\n      if (this.tokenData.refreshToken) {\n        this.tokenPromise = this.refreshToken().finally(() => {\n          this.tokenPromise = null;\n        });\n        return this.tokenPromise;\n      } else {\n        this.clearToken();\n        throw new Error(\"Token expired and no refresh token available\");\n      }\n    }\n\n    return this.tokenData.accessToken;\n  }\n\n  /**\n   * Get current patient ID from token (if available)\n   */\n  getPatientId(): string | undefined {\n    return this.tokenData?.patient;\n  }\n\n  /**\n   * Get current scopes from token\n   */\n  getScopes(): string[] {\n    if (!this.tokenData?.scope) {\n      return [];\n    }\n    return this.tokenData.scope.split(/\\s+/).filter((s) => s.length > 0);\n  }\n\n  /**\n   * Clear token and logout\n   */\n  logout(): void {\n    this.clearToken();\n  }\n\n  private clearToken(): void {\n    this.tokenData = null;\n    this.storage.remove(\"smart_token_data\");\n    this.storage.remove(\"smart_oauth_state\");\n    this.storage.remove(\"smart_pkce_verifier\");\n  }\n\n  /**\n   * Create token provider for FhirClient integration\n   */\n  tokenProvider(): TokenProvider {\n    return () => this.getToken();\n  }\n\n  /**\n   * Create default storage implementation\n   */\n  private createDefaultStorage(): SmartAuthStorage {\n    // Browser environment\n    if (typeof window !== \"undefined\" && window.sessionStorage) {\n      return {\n        get: (key: string) => sessionStorage.getItem(key),\n        set: (key: string, value: string) => sessionStorage.setItem(key, value),\n        remove: (key: string) => sessionStorage.removeItem(key),\n      };\n    }\n\n    // Node.js environment - use in-memory storage\n    const memoryStorage = new Map<string, string>();\n    return {\n      get: (key: string) => memoryStorage.get(key) ?? null,\n      set: (key: string, value: string) => memoryStorage.set(key, value),\n      remove: (key: string) => memoryStorage.delete(key),\n    };\n  }\n}\n"]}